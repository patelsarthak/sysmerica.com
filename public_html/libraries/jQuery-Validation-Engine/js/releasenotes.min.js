'use strict';

/*
*	Copyright, Cedric Dugas,
*	Do not sell or redistribute
*/(function($){marked.setOptions({gfm:!0,pedantic:!1,sanitize:!0});// Default setting
var defaultSettings={milestonesShown:10,// If you want to show private repo
// You need to add repo credentials in api.php
phpApi:!1,phpApiPath:'/',showDescription:!0,showComments:!0,// Used if phpApi is set to false
repo:'rails',username:'rails'};$.fn.releaseNotes=function(settings){settings=$.extend({},defaultSettings,settings||{});var apiPath=settings.phpApiPath+'api.php',respType=settings.phpApi?'json':'jsonp',releases={load:function load(el){var _this=this;this.$el=$(el),this.loadEvents();var options=$.extend(settings,{state:'closed',action:'milestones',sort:'due_date'});this.callApi(options).success(function(resp){resp.data&&(resp=resp.data),_this.showMilestones(resp);}).error(function(resp){console.log(resp);});},loadEvents:function loadEvents(){var _this=this;settings.showDescription&&this.$el.delegate('.issue','click',function(){return _this.loadIssueDesc(this),!1}),settings.showComments&&this.$el.delegate('.btnComments','click',function(){return _this.loadComments(this),!1});},loadIssueDesc:function loadIssueDesc(el){var $issue=$(el),data=$issue.data('issue');$bigIssue=$issue.find('.issueBig'),$bigIssue.is(':visible')?$bigIssue.slideUp():($('.issueBig').not($bigIssue).slideUp(),$bigIssue.find('.container').html(components.bigIssue(data,settings.showComments)),$bigIssue.slideDown());},showMilestones:function showMilestones(milestones){var _this=this;milestones.sort(this.sortDate),$.each(milestones,function(i,milestone){if(i==settings.milestonesShown)return !1;milestone.prettyDate=milestone.due_on?_this.getPrettyDate(milestone.due_on):_this.getPrettyDate(milestone.created_at),_this.$el.append(components.milestone(milestone));var options=$.extend(settings,{milestone:milestone.number,sort:'created',action:'issues',state:'closed'});_this.callApi(options).success(function(resp){resp.data&&(resp=resp.data),_this.showIssues(resp);});});},loadComments:function loadComments(el){var _this=this,issueid=$(el).attr('data-issue-id');$(el).fadeOut().slideUp();var options=$.extend(settings,{id:issueid,action:'comments'});this.callApi(options).success(function(resp){resp.data&&(resp=resp.data),_this.showComments(resp,issueid);});},showComments:function showComments(comments,issueid){var _this=this,$commentContainer=_this.$el.find('#issue'+issueid).find('.comments').empty();$.each(comments,function(i,comment){comment.prettyDate=_this.getPrettyDate(comment.created_at),$commentContainer.append(components.comment(comment,issueid));}),$commentContainer.slideDown();},showIssues:function showIssues(issues){var _this=this,jqMilestone=_this.$el.find('[data-id-milestone='+issues[0].milestone.number+']'),jqMilestoneIssues=jqMilestone.find('.issues');issues.sort(this.sortLabel),$.each(issues,function(i,issue){issue.prettyDate=_this.getPrettyDate(issue.closed_at),jqMilestoneIssues.append(components.issue(issue));}),jqMilestone.addClass('separator'),settings.showDescription&&jqMilestone.find('.issue').addClass('cursor');},getPrettyDate:function getPrettyDate(date){var dateFormat='';if(!date)return '';var date=date.split('T'),dateArray=date[0].split('-'),dateObj=new Date(dateArray[0],dateArray[1]-1,dateArray[2]),weekday=new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'),monthname=new Array('January','February','March','April','May','June','July','August','September','October','November','December');return dateFormat+=weekday[dateObj.getDay()]+', ',dateFormat+=monthname[dateObj.getMonth()]+' ',dateFormat+=dateObj.getDate()+', ',dateFormat+=dateObj.getFullYear(),dateFormat},sortDate:function sortDate(milestone1,milestone2){milestone1.dateTest=milestone1.due_on?milestone1.due_on:milestone1.created_at,milestone2.dateTest=milestone2.due_on?milestone2.due_on:milestone2.created_at;var date1=new Date(milestone1.dateTest),date2=new Date(milestone2.dateTest);return date1<date2?1:date1>date2?-1:0},sortLabel:function sortLabel(thisObject,thatObject){if(!thisObject.labels.length)return 1;return thatObject.labels.length?thisObject.labels[0].name>thatObject.labels[0].name?1:thisObject.labels[0].name<thatObject.labels[0].name?-1:0:-1},callApi:function callApi(options){var myoption=$.extend({},options),url=this.urls[options.action](options);return myoption.repo&&delete myoption.repo,myoption.username&&delete myoption.username,myoption.id&&delete myoption.id,myoption.action&&delete myoption.action,$.ajax({url:this.urls[options.action](options),dataType:respType,data:myoption})},urls:{domainName:'https://api.github.com',milestones:function milestones(){return settings.phpApi?apiPath:$url=this.domainName+'/repos/'+settings.username+'/'+settings.repo+'/milestones'},issues:function issues(){return settings.phpApi?apiPath:$url=this.domainName+'/repos/'+settings.username+'/'+settings.repo+'/issues'},comments:function comments(options){return settings.phpApi?apiPath:$url=this.domainName+'/repos/'+settings.username+'/'+settings.repo+'/issues/'+options.id+'/comments'}}};return this.each(function(){releases.load(this,settings);})};var components={milestone:function milestone(data){return $('<div data-id-milestone="'+data.number+'" class="milestoneContainer">    \t\t\t        <h3 class="release">'+data.title+'</h3>\t\t\t        <p class="dateRelease">Release Date: '+data.prettyDate+'</p>\t\t\t        <div class="issues"></div>\t\t\t  </div>').data('milestone',data)},issue:function issue(data){var labels='',_this=this;return $.each(data.labels,function(i,label){labels+=_this.label(label);}),$('<div id="issue'+data.number+'" class="issue" >\t\t\t\t<div class="issueSmall">\t\t\t\t\t<div class="issueTitle">'+labels+' '+$('<span>').html(data.title).text()+' </div>\t\t\t\t</div>\t\t\t\t<div style="display:none;" class="issueBig">\t\t\t\t\t<div class="container"></div>\t\t\t\t\t<div style="display:none;" class="comments"></div>\t\t\t\t</div>').data('issue',data)},label:function label(data){return '<span style="background-color:#'+data.color+';" class="label">'+data.name+'</span>'},bigIssue:function bigIssue(data,showComment){var commentLink=0!=data.comments&&showComment?'<a data-issue-id="'+data.number+'" href="#" class="btnComments btn">See Comments</a>':'';return $('<div class="avatar-bubble js-comment-container">\t            <span class="avatar"><img height="48" src="'+data.user.avatar_url+'" width="48"></span>\t            <div class="bubble">\t              <div class="comment starting-comment adminable" id="issue-3542089">\t                <div class="body">\t                  <p class="author">Opened by <a href="'+data.user.url+'">'+data.user.login+'</a>, issue closed on '+data.prettyDate+'</p>\t                  <h2 class="content-title"> '+$('<span>').html(data.title).text()+'</h2>\t                  <div class="formatted-content"> \t                    <div class="content-body markdown-body markdown-format">\t                        '+marked(data.body)+'\t                    </div>\t                  </div>\t                </div>\t              </div>\t            </div>\t          </div>'+commentLink).data('issue',data)},comment:function comment(data){return '<div class="avatar-bubble js-comment-container">\t\t\t\t    <span class="avatar"><img height="48" src="'+data.user.avatar_url+'" width="48"></span>\t\t\t\t    <div class="bubble">\t\t\t\t<div id="issuecomment-4369977" class="comment normal-comment adminable">\t\t\t\t  <div class="cmeta">\t\t\t\t    <p class="author">\t\t\t\t        <span class="icon"></span>\t\t\t\t      <strong class="author"><a href="'+data.user.url+'">'+data.user.login+'</a></strong>\t\t\t\t      <em class="action-text">\t\t\t\t        commented\t\t\t\t      </em>\t\t\t\t    </p>\t\t\t\t    <p class="info">\t\t\t\t      <em class="date"><time class="js-relative-date">'+data.prettyDate+'</time></em>\t\t\t\t    </p>\t\t\t\t  </div>\t\t\t\t  <div class="body">\t\t\t\t    <div class="formatted-content">\t\t\t\t      <div class="content-body markdown-body markdown-format">'+marked(data.body)+'</div>\t\t\t\t    </div>\t\t\t\t  </div>\t\t\t\t</div>\t\t\t\t    </div>\t\t\t\t  </div>'}};})(jQuery);
//# sourceMappingURL=releasenotes.min.js.map
